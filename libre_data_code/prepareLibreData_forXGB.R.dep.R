library(data.table)

x <- fread('~/Documents/data/libre_data/EileenKesson_glucose_24-10-2022.csv')

x <- data.table('datetime' = x$`Device Timestamp`,
                'glu' = x$`Historic Glucose mmol/L`)
x$datetime <- as.POSIXct(x$datetime, format = "%d-%m-%Y %H:%M")
x <- x[order(x$datetime), ]

plot(x$datetime, x$glu, cex = 0.2)

x$datetime[is.na(x$datetime)] <- '01-01-1900 00:00'
x <- x[datetime > '01-01-1900 00:00']

x$glu[is.na(x$glu)] <- 0
x <- x[glu>0]

sub <- x
sub <- sub %>% thicken("15 min") %>% select(-datetime) %>% pad()
sub.locf <- na.locf(sub)
sub <- sub.locf

sub <- sub[datetime_15_min > as.Date('2020-01-01')]
sub <- sub[datetime_15_min < as.Date('2021-06-01')]

plot(sub$datetime_15_min, sub$glu, pch = 16, cex = 0.4, col = rgb(0,0,0,0.2, maxColorValue = 1))

colnames(sub) <- c('glu', 'datetime')

write.table(sub, file = '~/Documents/data/libre_data/ek2.csv', sep = ',', row.names = F)

out <- x[datetime >= as.Date('2021-06-01') & datetime <= as.Date('2021-06-07')]
plot(out$datetime, out$glu, cex= 0)
lines(out$datetime, out$glu, cex= 0)

yh = c(11.3,        11.1,        10.84604836, 10.62059116, 10.33431244, 10.01557446,
9.72813606,  9.41716766,  9.2089529,   9.00580406,  8.87714958,  8.7746315,
8.5860014,   8.39141273,  8.26573944,  8.17976761,  8.1312027,   7.95373774,
7.94744539,  7.87656307,  7.91608906,  7.88864851,  7.87494898,  7.89549732,
7.8796854,   7.87714052,  7.8674345,   7.87807226,  7.90710831,  7.88259172,
7.87676573,  7.86769009,  7.85938501,  7.8466301,   7.66309261,  7.59691668,
7.49099016,  7.46757078,  7.54918766,  7.51764345,  7.51594067,  7.51516533,
7.51516533,  7.53027153,  7.53453588,  7.53623867,  7.53663826,  7.5341506 )

yh480 = c(11.3,        11.1,        10.86989403, 10.72979546, 10.33490849,  9.93844032,
          9.51073074,  9.09746552,  8.69757175,  8.51647282,  8.43551064,  8.31524277,
          8.16856956,  8.05913925, 7.91410589,  7.70694733,  7.52839422,  7.38633347,
          7.40548754,  7.47866488,  7.65904713,  7.89089537,  8.03837204,  8.06662941,
          8.0193634,   7.9101119,   7.8299861,   7.63155127,  7.34948587,  7.13079643,
          7.05457354,  7.13323402,  7.12447739,  7.06937313,  6.95223331,  6.8152051,
          6.59502506,  6.39439535,  6.28838062,  6.33255768,  6.43828869,  6.57573938,
          6.69644547,  6.77005053,  6.90797567,  6.91937923,  6.87274122,  6.90772486)

y <- c(11.3, 11.1, out$glu[1:58])
plot(y)
points(yh, col = 'red')
points(yh480, col = 'green')

yh2000 = c(11.3       , 11.1       , 10.87423992, 10.77265072, 10.60823631,
           10.3207016 ,  9.90736198,  9.52073765,  9.2103672 ,  8.93545151,
           8.70214844,  8.63762951,  8.47935677,  8.42740822,  8.29677391,
           8.20705795,  8.13525963,  8.01374054,  8.02181435,  8.07858944,
           8.11349678,  8.08059692,  8.07073402,  8.06587505,  8.05246067,
           8.00963402,  7.92917156,  7.804708  ,  7.64936686,  7.3422184 ,
           7.19419289,  7.20936155,  7.18316364,  7.08318043,  6.90046215,
           6.67297268,  6.50522852,  6.32132483,  6.37652206,  6.52414656,
           6.63799   ,  6.75072908,  7.08221483,  7.3447156 ,  7.49280119,
           7.70727491,  7.89467382,  8.07027054,  8.1987133 ,  8.22385597)
points(yh2000, col = 'blue')
